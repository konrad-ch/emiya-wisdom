<?phpfunction bin_rand($min = null, $max = null){    $min = ($min) ? (int) $min : 0;    $max = ($max) ? (int) $max : PHP_INT_MAX;       $range = range($min, $max);    $average = array_sum($range) / count($range);       $dist = array();    for ($x = $min; $x <= $max; $x++) {        $dist[$x] = -abs($average - $x) + $average + 1;    }       $map = array();    foreach ($dist as $int => $quantity) {        for ($x = 0; $x < $quantity; $x++) {            $map[] = $int;        }    }       shuffle($map);    return current($map);}function imagettfborder($im, $size, $angle, $x, $y, $color, $font, $text, $width){	// top	imagettftext($im, $size, $angle, $x-$width, $y-$width, $color, $font, $text);	imagettftext($im, $size, $angle, $x, $y-$width, $color, $font, $text);	imagettftext($im, $size, $angle, $x+$width, $y-$width, $color, $font, $text);	// bottom	imagettftext($im, $size, $angle, $x-$width, $y+$width, $color, $font, $text);	imagettftext($im, $size, $angle, $x, $y+$width, $color, $font, $text);	imagettftext($im, $size, $angle, $x-$width, $y+$width, $color, $font, $text);	// left	imagettftext($im, $size, $angle, $x-$width, $y, $color, $font, $text);	// right	imagettftext($im, $size, $angle, $x+$width, $y, $color, $font, $text);	for ($i = 1; $i < $width; $i++) {		// top line		imagettftext($im, $size, $angle, $x-$i, $y-$width, $color, $font, $text);		imagettftext($im, $size, $angle, $x+$i, $y-$width, $color, $font, $text);		// bottom line		imagettftext($im, $size, $angle, $x-$i, $y+$width, $color, $font, $text);		imagettftext($im, $size, $angle, $x+$i, $y+$width, $color, $font, $text);		// left line		imagettftext($im, $size, $angle, $x-$width, $y-$i, $color, $font, $text);		imagettftext($im, $size, $angle, $x-$width, $y+$i, $color, $font, $text);		// right line		imagettftext($im, $size, $angle, $x+$width, $y-$i, $color, $font, $text);		imagettftext($im, $size, $angle, $x+$width, $y+$i, $color, $font, $text);	}}function imagettfstroketext(&$image, $size, $angle, $x, $y, &$textcolor, &$strokecolor, $fontfile, $text, $px){    for($c1 = ($x-abs($px)); $c1 <= ($x+abs($px)); $c1++)        for($c2 = ($y-abs($px)); $c2 <= ($y+abs($px)); $c2++)            $bg = imagettftext($image, $size, $angle, $c1, $c2, $strokecolor, $fontfile, $text);   return imagettftext($image, $size, $angle, $x, $y, $textcolor, $fontfile, $text);}function GetTextWidth($fontSize, $font, $text){    $line_box = imagettfbbox ($fontSize, 0, $font, $text);    return ceil($line_box[0]+$line_box[2]); }function GetTextHeight($fontSize, $font, $text){    $line_box = imagettfbbox ($fontSize, 0, $font, $text);    return ceil($line_box[1]-$line_box[7]); }function GetMaxTextHeight($fontSize, $font, $textArray){    $maxHeight = 0;    for($i = 0; $i < count($textArray); $i++)    {               $height = GetTextHeight($fontSize, $font, $textArray[$i]);        if($height > $maxHeight)            $maxHeight = $height;    }    return $maxHeight;}function GetTextRowsFromText($fontSize, $font, $text, $maxWidth){       $text = str_replace("\n", "\n ", $text);	$text = str_replace("\\n", "\n ", $text);    $words = explode(" ", $text);    $rows = array();    $tmpRow = "";    for($i = 0; $i < count($words); $i++)    {        //last word        if($i == count($words) -1)        {            $rows[] = $tmpRow.$words[$i];            break;;        }        if(GetTextWidth($fontSize, $font, $tmpRow.$words[$i]) > $maxWidth) //break        {            $rows[] = $tmpRow;            $tmpRow = "";        }        else if(StringEndsWith($tmpRow, "\n ")) //break in text        {            $tmpRow = str_replace("\n ", "", $tmpRow);            $rows[] = $tmpRow;            $tmpRow = "";        }        //add new word to row           $tmpRow .= $words[$i]." ";    }    return $rows;}function StringEndsWith($haystack, $needle){    return $needle === "" || substr($haystack, -strlen($needle)) === $needle;}header('Content-Type: image/png');$im = imagecreatefrompng("emiya.png");$white = imagecolorallocate($im, 255, 255, 255);$black = imagecolorallocate($im, 0, 0, 0);$red = imagecolorallocate($im, 255, 0, 0);$grey = imagecolorallocate($im, 175, 175, 175);$blue = imagecolorallocate($im, 0, 0, 255);$darkblue = imagecolorallocate($im, 47, 65, 69);$font = 'Ogirema.ttf';$font_size = 20;$img_width = 768;$img_height = 432;$qfile = file_get_contents('wisdom.txt');$texts = explode("\n", $qfile);$num = bin_rand(0, count($texts)-1);$text = trim($texts[$num]);$padding = 50; //from edges$textRows = GetTextRowsFromText($font_size, $font, $text, $img_width - ($padding * 2));//check words lengthfor($i = 0; $i < count($textRows); $i++){	$text_width = GetTextWidth($font_size, $font, $textRows[$i]); 	if ($text_width > $img_width)	{		imagepng($im);		imagedestroy($im);		die();	}}$y = ($img_height - 12) - (30 * (count($textRows)-1));for($i = 0; $i < count($textRows); $i++){	$text_width = GetTextWidth($font_size, $font, $textRows[$i]); 	$position_center = floor(($img_width - $text_width) / 2);	$x = $position_center;	imagettfstroketext($im, $font_size, 0, $position_center, $y, $white, $darkblue, $font, $textRows[$i], 2);	$y += 30;}imagepng($im);imagedestroy($im);?>